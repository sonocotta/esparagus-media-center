# ============================================================
# Esparagus-Audio-Brick - Snapclient Configuration
# ============================================================
# ESP32 audio board with TAS5825M DAC (I2C+I2S) with built-in DSP
# Configured as a Snapcast client for synchronized audio
# There are two implementations available:
# 1) Basic snapclient without DSP controls (c-MM original port)
# 2) snapclient with added DSP controls (farmed-switch fork of c-MM port)
#     Frequencies: 40, 50, 60, 70, 80, 90, 100, 110, 120, 130,
#                 140, 200, 315, 500, 800, 1250, 2000, 5000 Hz
#     Range: -15dB to +15dB per band
# Board-specific pinouts defined in substitutions
# Functional blocks imported from /packages
# ============================================================

substitutions:
  name: esphome-web-26b490
  friendly_name: Esparagus-Audio-Brick
  task_stack_in_psram: "false"

  # ===== Board-Specific Pinouts =====
  # I2S Audio
  i2s_lrclk_pin: GPIO25
  i2s_bclk_pin: GPIO26
  i2s_dout_pin: GPIO22

  # TAS5825M
  tas58xx_variant: TAS5825M
  tas58xx_enable_pin: GPIO33
  i2c_sda_pin: GPIO21
  i2c_scl_pin: GPIO27

  # RGB LED
  rgb_led_pin: GPIO12

  # Ethernet (W5500)
  eth_clk_pin: GPIO18
  eth_mosi_pin: GPIO23
  eth_miso_pin: GPIO19
  eth_cs_pin: GPIO05
  eth_interrupt_pin: GPIO35
  eth_reset_pin: GPIO14

  # OLED (SPI)
  spi_clk_pin: GPIO18
  spi_mosi_pin: GPIO23
  spi_miso_pin: GPIO19
  display_cs_pin: GPIO15
  display_dc_pin: GPIO04
  display_reset_pin: GPIO32

  # ===== Snapcast Server Configuration =====
  snapcast_server_ip: "192.168.1.49"
  snapcast_server_port: "1704"
  
esphome:
  name: ${name}
  friendly_name: ${friendly_name}
  min_version: 2025.12.2
  name_add_mac_suffix: false
  platformio_options:
    board_build.flash_mode: dio
    
esp32:
  variant: esp32
  flash_size: 8MB
  cpu_frequency: 240MHz
  framework:
    type: esp-idf
    version: recommended
    advanced:
      minimum_chip_revision: "3.1" 
    sdkconfig_options:
      # Moves instructions and read onl`y data from flash into PSRAM on boot.
      # Both enabled allows instructions to execute while a flash operation is in progress without needing to be placed in IRAM.
      # Considerably speeds up mWW at the cost of using more PSRAM.
      CONFIG_SPIRAM_RODATA: "y"
      CONFIG_SPIRAM_FETCH_INSTRUCTIONS: "y"
      CONFIG_BT_ALLOCATION_FROM_SPIRAM_FIRST: "y"
      CONFIG_BT_BLE_DYNAMIC_ENV_MEMORY: "y"
      CONFIG_MBEDTLS_EXTERNAL_MEM_ALLOC: "y"
      CONFIG_MBEDTLS_SSL_PROTO_TLS1_3: "y"

logger:
  level: DEBUG

api:

ota:
  platform: esphome
  password: !secret esphome_ota_password

wifi:
  ssid: !secret esphome_wifi_ssid
  password: !secret esphome_wifi_password

psram:
  speed: 80MHz

network:
  enable_ipv6: true

# ===== Packages =====
packages:
  # Option A: TAS58xx configured with ganged 15-band EQ
  tas58xx_dac: !include packages/tas58xx-dac.yaml
  # Option B: TAS58xx configured with individual 15-band EQ per channel
  #tas58xx_dac_biamp: !include packages/tas58xx-dac-biamp.yaml
  # Option C: TAS58xx configured with bi-amp mode, with filters applied to both channels (HF or LF)
  #tas58xx_dac_biamp: !include packages/tas58xx-dac-presets.yaml

  monitoring: !include packages/monitoring.yaml
  light: !include packages/light.yaml
  # Optional ethernet (replace wifi config above if you use this)
  # ethernet: !include packages/ethernet-w5500.yaml
  oled: !include packages/oled.yaml
  
  # Option A: @c-MM original port of esp32-snapclient client
  # Basic implementation without DSP controls
  snapclient: !include packages/snapclient.yaml
  
  # Option B: @farmed-switch fork of the c-MM snapclient with added DSP controls
  # Implements software BQ-filters for basic DACs and controls hardware DSP for DSP-enabled DACs like TAS5805M
  # Probably makes less sense since DAC implements hardware EQ, but left here for testing and comparison
  #snapclient_with_dsp: !include packages/snapclient-with-dsp.yaml
